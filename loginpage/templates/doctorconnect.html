<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Connect Chat</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='premium.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .chat-container {
      max-width: 700px;
      margin: 20px auto;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      background-color: #fefefe;
      display: flex;
      flex-direction: column;
    }
    .chat-box {
      flex: 1;
      width: 100%;
      height: 400px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 5px;
      background-color: #fafafa;
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
    }
    .chat-message {
      margin: 5px 0;
      padding: 8px 12px;
      border-radius: 15px;
      display: inline-block;
      max-width: 80%;
      word-wrap: break-word;
    }
    .patient-msg {
      background-color: #d1e7dd;
      align-self: flex-end;
    }
    .doctor-msg {
      background-color: #f8d7da;
      align-self: flex-start;
    }
    .chat-input {
      display: 100%;
      gap: 10px;
    }
    .chat-input input {
      flex: 1;
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
    }
    .chat-input button {
      padding: 10px 20px;
      border-radius: 20px;
      width: 100%;
      border: none;
      background-color: #0d6efd;
      color: white;
      cursor: pointer;
    }
    .chat-input button:hover {
      background-color: #084298;
    }
    .chat-container{
      transition:  transform 0.3s fade-in-out;
    }
  </style>
</head>
<body>
<header class="header">
  <div class="logo"><i class="fa-solid fa-heartbeat"></i> CareConnect</div>
  <nav>
    <ul>
      <li><a href="{{ url_for('home') }}"><i class="fa-solid fa-house"></i> Home</a></li>
      <li><a href="{{ url_for('dashboard') }}"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
      <li><a href="{{ url_for('healthplan') }}"><i class="fa-solid fa-bowl-food"></i> Health Plan</a></li>
      <li><a href="{{ url_for('doctorconnect') }}"><i class="fa-solid fa-user-doctor"></i> Doctor Connect</a></li>
      <li><a href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
    </ul>
  </nav>
</header>

<div class="chat-container">
  <h2 class="text-center"><i class="fa-solid fa-comments"></i> Doctor Connect Chat</h2>
  <div class="chat-box" id="chatBox"></div>
  <div class="chat-input">
    <input type="text" id="chatInput" placeholder="Type your message...">
    <button id="sendBtn"><i class="fa-solid fa-paper-plane"></i> Send</button>
  </div>
</div>

<script>
const chatBox = document.getElementById('chatBox');
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');

// Append message to chat
function appendMessage(msg, sender) {
    const div = document.createElement('div');
    div.classList.add('chat-message', sender === 'patient' ? 'patient-msg' : 'doctor-msg');
    div.textContent = msg;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Send message to backend
async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;

    appendMessage(message, 'patient'); // show patient message
    chatInput.value = '';
    chatInput.disabled = true;
    sendBtn.disabled = true;

    try {
        const res = await fetch('/doctor_chat', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({message})
        });
        const data = await res.json();
        appendMessage(data.reply, 'doctor'); // show doctor reply
    } catch (err) {
        appendMessage("Error: Could not reach server.", 'doctor');
    } finally {
        chatInput.disabled = false;
        sendBtn.disabled = false;
        chatInput.focus();
    }
}

sendBtn.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMessage(); });
</script>
<footer>
  <p>&copy; 2025 CareConnect | Stay Healthy, Stay Safe</p>
</footer>
</body>
</html>
