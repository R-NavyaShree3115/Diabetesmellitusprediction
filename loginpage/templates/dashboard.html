<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CareConnect - Patient Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='chart.umd.min.js') }}"></script>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<link rel="stylesheet" href="{{ url_for('static', filename='premium.css') }}">
</head>
<style>
       .quick-btn:hover {
        background-color: #005ea0;
        box-shadow: 0 4px 8px rgba(0, 120, 215, 0.3);
    }
    @media (min-width: 640px) {
        .quick-btn {
            width: 30%;
        }
    }
</style>

<body>
   <!-- HEADER -->
  <header class="header">
    <div class="logo"><i class="fa-solid fa-heartbeat"></i> CareConnect</div>
    <nav>
      <ul>
        <li><a href="{{ url_for('home') }}"><i class="fa-solid fa-house"></i> Home</a></li>
        <li><a href="{{ url_for('dashboard') }}"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
        <li><a href="{{ url_for('healthplan') }}"><i class="fa-solid fa-bowl-food"></i> Health Plan</a></li>
        <li><a href="{{ url_for('doctorconnect') }}"><i class="fa-solid fa-user-doctor"></i> Doctor Connect</a></li>
        <li><a href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
      </ul>
    </nav>
  </header>

  <div class="container">
    <h1 style="font-weight:bold; color:#333;">Welcome to Your Diabetes Health Dashboard</h1>

    <!-- üîó Quick Links -->
    <div class="card">
      <h2 style="color:#0078D7;">Quick Links</h2>
      <div style="display:flex; justify-content:center; gap:15px; flex-wrap:wrap;">
        <button onclick="window.location.href='premium'" class="quick-btn">üß† Prediction</button>
        <button onclick="window.location.href='healthplan'" class="quick-btn">üíä Health Plan</button>
        <button onclick="window.location.href='doctorconnect'" class="quick-btn">üë®‚Äç‚öïÔ∏è Doctor Contact</button>
      </div>
    </div>

 <!-- ü©∫ Health Plan Preview -->
<div class="card">
  <h2 style="color:#0b7dda;">Your Current Health Plan</h2>
 

  <div style="display:flex; gap:25px; flex-wrap:wrap;">
    <div style="flex:1; min-width:250px;">
      <h3><i class="fa-solid fa-bowl-food"></i> Diet</h3>
      <ul>
        {% if diet_recommendations %}
          {% for item in diet_recommendations %}
            <li>{{ item }}</li>
          {% endfor %}
        {% else %}
          <li>No diet recommendations available.</li>
        {% endif %}
      </ul>
    </div>
<br>
    <div style="flex:1; min-width:250px;">
      <h3><i class="fa-solid fa-person-running"></i> Exercise</h3>
      <ul>
        {% if exercise_recommendations %}
          {% for item in exercise_recommendations %}
            <li>{{ item }}</li>
          {% endfor %}
        {% else %}
          <li>No exercise recommendations available.</li>
        {% endif %}
      </ul>
    </div>
<br>
    <div style="flex:1; min-width:250px;">
      <h3><i class="fa-brands fa-pagelines"></i> Yoga</h3>
      <ul><li>
        {% if yoga_recommendations %}
          {{ yoga_recommendations }}</li>
        {% else %}
         <li>No yoga recommendations available.</li>
        {% endif %}
      </ul>
    </div><br>
  </div>
</div>



    <!-- ü©∏ Glucose Tracking Chart -->
    <div class="card" id="tracking">
      <h2 style="color:#026ab4;">Glucose Tracking Chart</h2>
      <canvas id="glucoseChart"></canvas>
      <p id="noDataMsg" style="text-align:center; color:red; display:none;">No glucose readings yet.</p>
    </div>
 <!-- ü©∏ BP Tracking Chart -->
    <div class="card">
      <h2 style="color:#b40000;">Blood Pressure Tracking Chart</h2>
      <canvas id="bpChart"></canvas>
      <p id="noBPMsg" style="text-align:center; color:red; display:none;">No BP readings yet.</p>
    </div>
    
  

  <div style="display: flex;padding: left 60px;; justify-content: center; margin: 20px 0;width: 50%;">
    <button id="downloadBtn">üìÑ Download Report</button>
</div>

  </div>

<br><br>
<script>
document.getElementById('downloadBtn').addEventListener('click', function() {
    fetch("{{ url_for('download_report') }}")
        .then(resp => resp.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "health_report.pdf";
            document.body.appendChild(a);
            a.click();
            a.remove();
        })
        .catch(err => console.error("Download failed", err));
});
</script>


  <footer>
    <p>&copy; 2025 CareConnect | Stay Healthy, Stay Safe</p>
  </footer>

  <!-- üìä HEALTH PLAN FETCH SCRIPT -->
    <script>
    // ----------- Glucose Chart --------------
    const glucoseLabels = JSON.parse('{{ dates | default([]) | tojson | safe }}');
    const glucoseData = JSON.parse('{{ glucose_values | default([]) | tojson | safe }}');

    const gCanvas = document.getElementById('glucoseChart');
    if (glucoseData.length && gCanvas) {
        new Chart(gCanvas.getContext('2d'), {
            type: 'line',
            data: {
                labels: glucoseLabels,
                datasets: [{
                    label: 'Glucose (mg/dL)',
                    data: glucoseData,
                    borderColor: '#0078D7',
                    backgroundColor: 'rgba(0, 120, 215, 0.15)',
                    borderWidth: 2
                }]
            }
        });
    } else {
        document.getElementById('noDataMsg').style.display = 'block';
    }

    // ----------- BP Chart -------------------
    const bpLabels = JSON.parse('{{ bp_dates | default([]) | tojson | safe }}');
    const bpValues = JSON.parse('{{ bp_values | default([]) | tojson | safe }}');

    const bpCanvas = document.getElementById('bpChart');
    if (bpValues.length && bpCanvas) {
        new Chart(bpCanvas.getContext('2d'), {
            type: 'line',
            data: {
                labels: bpLabels,
                datasets: [{
                    label: 'Blood Pressure (mmHg)',
                    data: bpValues,
                    borderColor: '#d9534f',
                    backgroundColor: 'rgba(217, 83, 79, 0.15)',
                    borderWidth: 2
                }]
            }
        });
    } else {
        document.getElementById('noBPMsg').style.display = 'block';
    }
  </script>

  <style>
    .quick-btn {
      width: 30%;
      text-align: center;
      border: none;
      border-radius: 8px;
      background-color: #0078D7;
      color: white;
      cursor: pointer;
      padding: 10px;
      font-size: 16px;
      transition: background 0.2s ease;
    }
    .quick-btn:hover { background-color:#005ea0; }
  </style>
<script src="https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js"></script>
</body>
</html>
