<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Progress Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='premium.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo"><i class="fa-solid fa-heartbeat"></i> CareConnect</div>
    <nav>
      <ul>
        <li><a href="{{ url_for('home') }}"><i class="fa-solid fa-house"></i> Home</a></li>
        <li><a href="{{ url_for('dashboard') }}"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
        <li><a href="{{ url_for('healthplan') }}"><i class="fa-solid fa-bowl-food"></i> Health Plan</a></li>
        <li><a href="{{ url_for('progress') }}" class="active"><i class="fa-solid fa-chart-pie"></i> Progress</a></li>
        <li><a href="{{ url_for('alerts') }}"><i class="fa-solid fa-bell"></i> Alerts</a></li>
        <li><a href="{{ url_for('doctorconnect') }}"><i class="fa-solid fa-user-doctor"></i> Doctor Connect</a></li>
        <li><a href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
      </ul>
    </nav>
  </header>
<section class="container">
  <!-- Risk Section -->
  <section class="card" id="risk-section" style="margin: 20px 0;">
    <h3>Risk Level: <span id="risk-text">Loading...</span></h3>
    <div class="progress" style="height: 25px;">
      <div id="risk-bar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
    </div>
  </section>

  <!-- Charts Section -->
  <section class="card">
    <h2><i class="fa-solid fa-chart-line"></i> Glucose Trend</h2>
    <canvas id="glucoseChart"></canvas>
  </section>

  <section class="card">
    <h2><i class="fa-solid fa-dumbbell"></i> Diet & Exercise Adherence</h2>
    <canvas id="adherenceChart"></canvas>
  </section>
</section>
  <footer>
    <p>&copy; 2025 CareConnect | Stay Healthy, Stay Safe</p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="{{ url_for('static', filename='premium.js') }}"></script>
  <script>
    // Optional: navigation helpers
    function goHome() { window.location.href = "{{ url_for('home') }}"; }
    function logout() { window.location.href = "{{ url_for('logout') }}"; }
    function goDashboard() { window.location.href = "{{ url_for('dashboard') }}"; }
    // Progress dashboard charts (glucose & adherence)
document.addEventListener("DOMContentLoaded", function () {
  const history = JSON.parse(localStorage.getItem("predictionHistory")) || [];
  const riskText = document.getElementById("risk-text");
  const riskBar = document.getElementById("risk-bar");

  if (history.length > 0) {
    const latest = history[0];
    const isDiabetic = latest.status.includes("Diabetic");
    riskText.textContent = latest.status;
    riskBar.style.width = isDiabetic ? "85%" : "35%";
    riskBar.style.backgroundColor = isDiabetic ? "red" : "green";

    // Glucose line chart
    const ctxGlucose = document.getElementById("glucoseChart")?.getContext("2d");
    if (ctxGlucose) {
      const dates = history.map(h => h.date).reverse();
      const glucoseValues = history.map(h => h.glucose || 100).reverse();
      new Chart(ctxGlucose, {
        type: "line",
        data: { labels: dates, datasets: [{ label: "Glucose Trend", data: glucoseValues, borderColor: "#36A2EB", fill: true, backgroundColor: "rgba(54,162,235,0.3)" }] }
      });
    }

    // Diet & Exercise bar chart
    const ctxAdherence = document.getElementById("adherenceChart")?.getContext("2d");
    if (ctxAdherence) {
      const dietAdherence = history.map(h => h.dietAdherence || 0).reverse();
      const exerciseAdherence = history.map(h => h.exerciseAdherence || 0).reverse();
      new Chart(ctxAdherence, {
        type: "bar",
        data: {
          labels: history.map(h => h.date).reverse(),
          datasets: [
            { label: "Diet %", data: dietAdherence, backgroundColor: "#4CAF50" },
            { label: "Exercise %", data: exerciseAdherence, backgroundColor: "#FF9800" }
          ]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
      });
    }

  } else {
    riskText.textContent = "No prediction data yet.";
    riskBar.style.width = "0%";
  }
});

  </script>
</body>
</html>
