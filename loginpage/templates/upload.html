<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title >CareConnect - Home</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='premium.css') }}">

<style>

  .flash-success { color: green; }
  .flash-error { color: red; }
  #loading { font-weight: bold; color: blue; display: none; }
  #preview table { border-collapse: collapse; width: 40%; }
  #preview th, #preview td { border: 1px solid #ddd; padding: 2px; text-align: center; }
  #preview th { background-color: #f2f2f2; }
  #results { margin-top: 20px; }
  #predict-btn{
    margin-left: 40%;
    background-color: none;
    color: white;
    
    border: none;
    border-radius: 5px;
    cursor: pointer;
    width: 100px ;
  }
  #card{
    width: 70%;
    margin: auto;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    border-radius: 10px;
    padding: 20px;
    background-color: #fff;
    height: fit-content;
  }
 
</style>
</head>

<body>
<header class="header">
  <div class="logo"><i class="fa-solid fa-heartbeat"></i> CareConnect</div>
  <nav>
    <ul>
      <li><a  href="http://127.0.0.1:5000"><i class="fa-solid fa-house"></i> Home</a></li>
      <li><a href="http://127.0.0.1:5000/logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>

    </ul>
  </nav>
</header><br><br>
<div class="card" id="card">

<section class="card-content">
  <h2>üìÇ Upload CSV to Train Models</h2>
  <form id="uploadForm" enctype="multipart/form-data">
    <input type="file" name="dataset" required>
    <button type="submit">Upload & Train</button>
  </form>

  <div id="loading">‚è≥ Processing... Please wait.</div>
  <div id="messages"></div>
  <div id="preview"></div>
  <div id="results"></div>
    </div>
    <button id="predict-btn" style="display:none;">Predict</button><br><br>
</section>

</div>

<br>
<br><br>
<footer>
  <p>&copy; 2025 CareConnect. All rights reserved | Stay Healthy</p>
</footer>

<script>
  //server endpoint
  const serverUrl = "http://127.0.0.1:5000/upload";
const form = document.getElementById('uploadForm');
const loading = document.getElementById('loading');
const messages = document.getElementById('messages');
const preview = document.getElementById('preview');
const results = document.getElementById('results');


form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Clear previous outputs
    messages.innerHTML = '';
    preview.innerHTML = '';
    results.innerHTML = '';

    const file = form.querySelector('input[name="dataset"]').files[0];
    if (!file) return alert("‚ùå No file selected!");

    const formData = new FormData();
    formData.append('dataset', file);

    loading.style.display = 'block';

    try {
        // Upload CSV and train models
        const res = await fetch('http://127.0.0.1:5000/upload_csv', {
            method: 'POST',
            body: formData
        });

        const data = await res.json();
        loading.style.display = 'none';

        if (data.status === 'success') {
            messages.innerHTML = '<span class="flash-success">‚úÖ ' + data.message + '</span>';
            preview.innerHTML = '<h3>Preview</h3>' + data.preview;

            // Show model accuracies
            let html = '<h3>Model Accuracies:</h3><ul>';
            for (const [model, acc] of Object.entries(data.accuracies)) {
                html += `<li>${model}: ${acc}%</li>`;
            }
            html += `</ul><strong>üèÜ Best Model:</strong> ${data.best_model}`;
            results.innerHTML = html;
            

              // ‚úÖ Show Predict button
            document.getElementById('predict-btn').style.display = 'inline-block';



        } else {
            messages.innerHTML = '<span class="flash-error">‚ùå ' + data.message + '</span>';
        }

    } catch (err) {
        loading.style.display = 'none';
        messages.innerHTML = '<span class="flash-error">‚ùå Error: ' + err.message + '</span>';
    }
});
  document.getElementById('predict-btn').onclick = function() {
  window.location.href = "/premium";
}
// Home and Logout functions when clicked on buttons in navbar
function goHome() {
  window.location.href = "http://127.0.0.1:5000";
}
function logout() {
  window.location.href = "http://127.0.0.1:5000/logout";
}
</script>
</body>
</html>
